<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OSM Auth Callback</title>
</head>
<body>
    <h1>Authenticating...</h1>
    <script>
        const BACKEND_URL = 'https://vikings-osm-event-manager.onrender.com'; // <-- Set your Render backend URL here

        // Get the ?code=... from the URL
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        if (code) {
            // Exchange code for access token via backend
            fetch(`${BACKEND_URL}/exchange-token`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    code: code,
                    redirect_uri: window.location.origin + '/callback.html'
                })
            })
            .then(res => res.json())
            .then(data => {
                console.log('Token exchange response:', data);
                if (data.access_token) {
                    localStorage.setItem('access_token', data.access_token);
                    window.location.href = 'index.html';
                } else {
                    document.body.innerHTML = '<h1>Authentication failed.</h1><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            });
        } else {
            document.body.innerHTML = '<h1>No code found in URL.</h1>';
        }
    </script>
</body>
</html>